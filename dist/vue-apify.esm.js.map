{"version":3,"file":null,"sources":["../lib/utils/args-parser.js","../lib/utils/compose.js","../lib/create-api-map.js","../lib/install.js","../lib/index.js"],"sourcesContent":["import pathToRegexp from 'path-to-regexp'\n\nexport default function parseExecArgs (url, props) {\n  const result = { url }\n  if (!props) {\n    return result\n  }\n  const { url_params, params, data } = props\n  if (url_params) {\n    /*\n      TODO: add validations of url_params\n      let names = pathToRegexp.parse(url)\n        .filter(token => typeof token !== 'string' )\n        .map(({ name }) => name)\n      names === Object.keys(url_params)\n    */\n    const toPath = pathToRegexp.compile(url)\n    result.url = toPath(url_params)\n  }\n  if (params) {\n    result.params = params\n  }\n  if (data) {\n    result.data = data\n  }\n  return result\n}","export default function compose (hooks) {\n  if (!Array.isArray(hooks)) throw new TypeError('Hooks stack must be an array!')\n  hooks.forEach(fn => { if (typeof fn !== 'function') throw new TypeError('Hooks must be composed of functions!') })\n  // for (const fn of hooks) {\n  //   if (typeof fn !== 'function') throw new TypeError('Hooks must be composed of functions!')\n  // }\n  \n  return function (context, next) {\n    // last called middleware #\n    let index = -1\n    return dispatch(0)\n    function dispatch (i) {\n      if (i <= index) return Promise.reject(new Error('next() called multiple times'))\n      index = i\n      let fn = hooks[i]\n      if (i === hooks.length) fn = next\n      if (!fn) return Promise.resolve()\n      try {\n        return Promise.resolve(fn(context, function next () {\n          return dispatch(i + 1)\n        }))\n      } catch (err) {\n        return Promise.reject(err)\n      }\n    }\n  }\n}","import parseExecArgs from './utils/args-parser'\nimport compose from './utils/compose'\nimport merge from 'deepmerge'\n\n\nexport function createApiMap (records, { axiosInstance }) {\n  const apiMap = {}\n  records.forEach(api => addApiRecord(apiMap, api, {}, axiosInstance ))\n  return apiMap\n}\n\nexport function addApiRecord (apiMap, record, acc, axiosInstance) {\n  record = normalizeRecord(record, acc)\n  apiMap[record.name] = {}\n\n  if (record.children.length) {\n    record.children.forEach(child => { addApiRecord(apiMap[record.name], child, record, axiosInstance) })\n    return\n  }\n  apiMap[record.name] = createExecFunc(record, axiosInstance)\n}\n\nexport function normalizeRecord (record, props) {\n  const { options = {}, meta = {}, hooks = [] } = props\n  const createSimpleChildRecord = (url, method) => ({ name: method.toLowerCase(), options: { url, method } })\n  const normalizedRecord = {\n    name: record.name,\n    children: record.children || [],\n    options: merge.all([options, record.options || {}]),\n    meta: merge.all([meta, record.meta || {}]),\n    hooks: record.hooks && record.hooks.length\n      ? hooks.concat(record.hooks)\n      : hooks.slice()\n  }\n  if (record.url && record.method) {\n    normalizedRecord.options = merge.all([normalizedRecord.options, { url: record.url, method: record.method }])\n  }\n  if (normalizedRecord.children.length && normalizedRecord.options.method && normalizedRecord.options.url) {\n    normalizedRecord.children.push(createSimpleChildRecord(normalizedRecord.options.url, normalizedRecord.options.method))\n    delete normalizedRecord.options.url\n    delete normalizedRecord.options.method\n  }\n  return normalizedRecord\n}\n\nexport function createExecFunc (record, axiosInstance) {\n  function createContext({ meta, options }) {\n    return {\n      meta,\n      options,\n      response: null\n    }\n  }\n  function createRequestFunc () {\n    return function (ctx, next) {\n      return axiosInstance(record.options)\n        .then(response => {\n          ctx.response = response\n          next()\n        })\n    }\n  }\n  return function (payload) {\n    record.options = merge(record.options, parseExecArgs(record.options.url, payload))\n    record.hooks.push(createRequestFunc())\n\n    const fn = compose(record.hooks)\n    const context = createContext(record)\n\n    return fn(context).then(() => context)\n  }\n}\n","export function install (Vue) {\n  Object.defineProperty(Vue.prototype, '$api', {\n    get () { return this.$options.api }\n  })\n}","import { createApiMap } from './create-api-map'\nimport { install } from './install'\n\nexport default class VueApify {\n  static create (records, axiosInstance) {\n    return createApiMap(records, axiosInstance)\n  }\n}\n\nVueApify.install = install\n"],"names":["const","let"],"mappings":"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"}